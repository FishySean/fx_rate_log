<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exchange Rates</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- 引入 Chart.js 库 -->
</head>
<body>
    <h1>CNY/USD Exchange Rate Comparison</h1>
    
    <canvas id="exchangeRateChart" width="400" height="200"></canvas> <!-- Chart.js 的画布 -->

    <script>
        // 从后端获取数据
        fetch('/rates_data')
        .then(response => response.json())
        .then(data => {
            // 分别获取招商银行和中国银行的时间标签
            const cmb_times = data.cmb.times;
            const boc_times = data.boc.times;

            // 招商银行汇率
            const cmb_rthBid = data.cmb.rthBid;  // 综合汇率
            const cmb_rtcBid = data.cmb.rtcBid;  // 现钞买入价
            const cmb_rtcOfr = data.cmb.rtcOfr;  // 现钞卖出价
            const cmb_rthOfr = data.cmb.rthOfr;  // 现汇卖出价
            const cmb_rtbBid = data.cmb.rtbBid;  // 现汇买入价

            // 中国银行汇率
            const boc_rthBid = data.boc.rthBid;  // 综合汇率
            const boc_rtcBid = data.boc.rtcBid;  // 现钞买入价
            const boc_rtcOfr = data.boc.rtcOfr;  // 现钞卖出价
            const boc_rthOfr = data.boc.rthOfr;  // 现汇卖出价
            const boc_rtbBid = data.boc.rtbBid;  // 现汇买入价

            // 使用 Chart.js 渲染图表
            const ctx = document.getElementById('exchangeRateChart').getContext('2d');
            const exchangeRateChart = new Chart(ctx, {
                type: 'line',  // 折线图
                data: {
                    labels: cmb_times,  // 时间标签使用招商银行的时间
                    datasets: [
                        // 招商银行数据集
                        {
                            label: '招商银行综合汇率',
                            data: cmb_rtbBid,
                            borderColor: 'rgba(75, 192, 192, 1)',
                            fill: false
                        },
                        {
                            label: '招商银行现钞买入价',
                            data: cmb_rtcBid,
                            borderColor: 'rgba(75, 192, 192, 0.7)',
                            fill: false
                        },
                        {
                            label: '招商银行现钞卖出价',
                            data: cmb_rtcOfr,
                            borderColor: 'rgba(75, 192, 192, 0.5)',
                            fill: false
                        },
                        {
                            label: '招商银行现汇卖出价',
                            data: cmb_rthOfr,
                            borderColor: 'rgba(75, 192, 192, 0.3)',
                            fill: false
                        },
                        {
                            label: '招商银行现汇买入价',
                            data: cmb_rthBid,
                            borderColor: 'rgba(75, 192, 192, 0.1)',
                            fill: false
                        },

                        // 中国银行数据集
                        {
                            label: '中国银行综合汇率',
                            data: boc_rtbBid,
                            borderColor: 'rgba(255, 99, 132, 1)',
                            fill: false,
                            xAxisID: 'boc-axis'  // 用于区分不同银行的x轴
                        },
                        {
                            label: '中国银行现钞买入价',
                            data: boc_rtcBid,
                            borderColor: 'rgba(255, 99, 132, 0.7)',
                            fill: false,
                            xAxisID: 'boc-axis'
                        },
                        {
                            label: '中国银行现钞卖出价',
                            data: boc_rtcOfr,
                            borderColor: 'rgba(255, 99, 132, 0.5)',
                            fill: false,
                            xAxisID: 'boc-axis'
                        },
                        {
                            label: '中国银行现汇卖出价',
                            data: boc_rthOfr,
                            borderColor: 'rgba(255, 99, 132, 0.3)',
                            fill: false,
                            xAxisID: 'boc-axis'
                        },
                        {
                            label: '中国银行现汇买入价',
                            data: boc_rthBid,
                            borderColor: 'rgba(255, 99, 132, 0.1)',
                            fill: false,
                            xAxisID: 'boc-axis'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: '时间'
                            },
                            type: 'category',  // 使用 category 以显示时间点
                            position: 'bottom',  // 在底部显示 x 轴
                            ticks: {
                                autoSkip: true,
                                maxTicksLimit: 10
                            }
                        },
                        'boc-axis': {  // 为中国银行定义单独的 x 轴
                            position: 'top',  // 将 BOC 的 x 轴放在顶部
                            title: {
                                display: true,
                                text: '中国银行时间'
                            },
                            labels: boc_times,  // 使用中国银行的时间
                            type: 'category',
                            ticks: {
                                autoSkip: true,
                                maxTicksLimit: 10
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: '汇率 (人民币/美元)'
                            },
                            beginAtZero: false
                        }
                    }
                }
            });
        })
        .catch(error => console.error('Error fetching data:', error));
    </script>
</body>
</html>
